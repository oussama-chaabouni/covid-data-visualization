<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.0/d3-tip.js"
            integrity="sha512-9WNL1D7EK7WwRB4smgvl1S2wEGeWP+xHjxEhzyUjasZZQGDUEPHBEkXgVKNcwxqqjzA7CnIEz/MhxiU79IdG1A=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="dashboard-style.css">
</head>
<body>
<div class="navbar">

    <a class="home" href="#home"><img src="./assets/home-logo.svg" class="home-icon">Home</a>


    <div class="navbar-right">
        <a class="about" href="#about"><img src="./assets/about-logo.svg" class="about-icon">About</a>
        <a class="github" href="#github"><img src="./assets/github-logo.svg" class="github-icon">Github</a>

    </div>

    <a class="menu"><img src="./assets/menu.svg" id="menu-icon"></a>
</div>

<div class="overlay">
    <a class="close">&times;</a>
    <div class="overlay__content">
        <a class="about-mobile"><img src="./assets/about-logo.svg" class="about-icon">About</a>
        <a class="github-mobile"><img src="./assets/github-logo.svg" class="github-icon">Github</a>
    </div>
</div>

<div class="page-title">
    <span class="title">Dashboard</span>
    <span class="title-text">Explore the COVID-19 data</span>
    <span class="filter-data">Filter Data</span>

</div>
<div class="radio-selection">
    <div id="world-country-container">
        <input type="radio" class="choice"
               value="world" name="selec" checked >
        <label class="world-text" >World Map</label><br>

        <input type="radio" class="choice"
               value="country" name="selec">
        <label class="country-text">Select a Country</label>
        <select id="cities" >
            <!--            onchange="selectCountry()"-->
            <option value=""></option>
        </select>
    </div>
    <div class="date-selection">
        <label id="start-label">Date From</label>

        <input type="date" id="start" name="trip-start"
               value="2020-07-22"
               min="2020-01-01" max="2021-12-31" >

        <label id="end-label">Date To</label>

        <input type="date" id="end" name="trip-start"
               min="2020-01-01" >
    </div>
</div>
<div class="filter">


<!--    <button class="total-cases">-->
<!--        <span class="total-cases-text">Total Cases</span>-->
<!--        <div class="stat">-->
<!--            <img src="./assets/up-graph.svg" class="up-graph">-->
<!--            <img src="./assets/up-logo.svg" class="up-logo"><span class="percentage">+12%</span>-->
<!--        </div>-->
<!--    </button>-->

<!--    <button class="new-cases">-->
<!--        <span class="button-text">New Cases</span>-->
<!--        <div class="stat">-->
<!--            <img src="./assets/down-graph.svg" class="down-graph-not-selected">-->
<!--            <img src="./assets/down-logo.svg" class="up-logo"><span class="percentage-negative">-5.3%</span>-->
<!--        </div>-->
<!--    </button>-->


<!--    <button class="total-vaccinations-per-hundred">-->
<!--        <span class="button-text-vaccine">Total Vaccinations per hundred</span>-->
<!--        <div class="stat">-->
<!--            <img src="./assets/up-graph-not-selected.svg" class="down-graph-not-selected">-->
<!--            <img src="./assets/up-logo-not-selected.svg" class="up-logo"><span class="percentage-positive">+25.7%</span>-->
<!--        </div>-->
<!--    </button>-->

</div>

<div id="covid" ></div>
<script src="script.js"></script>

<script>
    const doc = document;
    const menuOpen = doc.querySelector('.menu');
    const menuClose = doc.querySelector('.close');
    const overlay = doc.querySelector('.overlay');

    function refetchData(v){
        console.log(v)
    }

    menuOpen.addEventListener('click', () => {
        overlay.classList.add('overlay--active');
    });

    menuClose.addEventListener('click', () => {
        overlay.classList.remove('overlay--active');
    });



    d3.json('http://localhost:7070/countries').then(function (data) {
            var coutriesSelect = document.getElementById('cities');

            Object.keys(data).forEach(item => {
                    var op = document.createElement('option')
                    op.setAttribute('value', item);
                    op.append(document.createTextNode(data[item]));
                    coutriesSelect.appendChild(op);
                },
            );

        },
    )

    document.getElementById('end').valueAsDate = new Date();

    d3.json('http://localhost:7070/criteria').then(function (data) {

        var begin = document.getElementById('start')
        var end = document.getElementById('end')
        data.forEach((item, index) => {
                var btn = document.createElement('button')
                btn.setAttribute('value', item);
                btn.className = 'button-rect'


                document.getElementsByClassName('filter')[0].appendChild(btn);
                var span = document.createElement('span')
                span.innerHTML = item.replaceAll('_', ' ')
                span.className = 'button-text'
                document.getElementsByTagName('button')[index].appendChild(span);



                function setThisButtonActive(button) {
                    button.classList.replace('button-rect', 'button-rect-active');

                }

                /* select all active buttons, and remove the active class from them */
                function resetActiveButton() {
                    document.querySelectorAll('.button-rect-active').forEach((button) => {
                        button.classList.replace('button-rect-active', 'button-rect');
                    });
                }

                //   filterData(begin.value,end,btn)

                document.querySelectorAll('.button-rect').forEach((button) => {
                    var total_cases= document.querySelector("[value='total_cases']");
                    setThisButtonActive(total_cases);
                    document.getElementById('cities').onchange = function (event) {
                        selectData(event.target.value)
                             resetActiveButton();
                             setThisButtonActive(total_cases);
                    };
                        btn.onclick = function () {
                            resetActiveButton();
                            setThisButtonActive(button);

                            if(document.getElementById('cities').value !== '')

                            filterData(new Date(begin.value), new Date(end.value), btn.value)


                            // document.getElementById('cities').onchange = function (event) {
                            //
                            //     resetActiveButton();
                            //     setThisButtonActive(total_cases);
                            // };

                            begin.onchange = function () {
                                begin = document.getElementById('start')
                                // selectCountry(btn.value,begin.value,end.value,option.value)
                                filterData(new Date(begin.value), new Date(end.value), btn.value)
                            }


                            end.onchange = function () {
                                end = document.getElementById('end')
                                filterData(new Date(begin.value), new Date(end.value), btn.value)

                            }
                        }


                    },
                )


            },
        )
    })

    // var btn = document.getElementsByTagName('button')
    //
    // btn.onclick = selectFilter(btn)

</script>

</body>
</html>
