<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.0/d3-tip.js"
            integrity="sha512-9WNL1D7EK7WwRB4smgvl1S2wEGeWP+xHjxEhzyUjasZZQGDUEPHBEkXgVKNcwxqqjzA7CnIEz/MhxiU79IdG1A=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="//d3js.org/d3-geo-projection.v1.min.js"></script>
    <script src="//d3js.org/topojson.v2.min.js"></script>
    <style>

        .graticule {
            fill: none;
            stroke: #777;
            stroke-width: .5px;
            stroke-opacity: .5;
        }
        .sphere {
            fill: #7BB5FF;
        }
        .gradient {
            fill: url(#gradient);
        }
        .country {
            /*fill: #404F24;*/
            fill-opacity: 0.7;
            stroke: #eee;
            stroke-width: 0.2;
        }
    </style>
    <link rel="stylesheet" href="dashboard-style.css">
</head>
<body>
<div class="navbar">

    <a class="home" href="#home"><img src="./assets/home-logo.svg" class="home-icon">Home</a>


    <div class="navbar-right">
        <a class="about" href="#about"><img src="./assets/about-logo.svg" class="about-icon">About</a>
        <a class="github" href="#github"><img src="./assets/github-logo.svg" class="github-icon">Github</a>

    </div>

    <a class="menu"><img src="./assets/menu.svg" id="menu-icon"></a>
</div>

<div class="overlay">
    <a class="close">&times;</a>
    <div class="overlay__content">
        <a class="about-mobile"><img src="./assets/about-logo.svg" class="about-icon">About</a>
        <a class="github-mobile"><img src="./assets/github-logo.svg" class="github-icon">Github</a>
    </div>
</div>

<div class="page-title">
    <span class="title">Dashboard</span>
    <span class="title-text">Explore the COVID-19 data</span>


</div>
<div class="radio-selection">
    <div id="world-country-container">
        <input type="radio" class="choice"
               value="world" name="selec" checked>
        <label class="world-text">World Map</label><br>

        <input type="radio" class="choice"
               value="country" name="selec">
        <label class="country-text">Select a Country</label>
        <select id="cities">

            <option value=""></option>
        </select>
    </div>
    <div class="date-selection">
        <label id="start-label">Date From</label>

        <input type="date" id="start" name="trip-start"
               value="2020-07-22"
               min="2020-01-01" max="2021-12-31">

        <label id="end-label">Date To</label>

        <input type="date" id="end" name="trip-start"
               min="2020-01-01">
    </div>
</div>
<div class="filter">
    <div class="filter-text">
        <span class="filter-data">Filter Data</span>
    </div>
    <div>
        <div class="selected" value="total_cases">
            Total Cases
        </div>
        <div class="options-container"></div>
    </div>





</div>

<div id="covid"></div>
<script src="script.js"></script>
<script src="globe.js"></script>
<script>
    const doc = document;
    const menuOpen = doc.querySelector('.menu');
    const menuClose = doc.querySelector('.close');
    const overlay = doc.querySelector('.overlay');

    function refetchData(v) {
        console.log(v)
    }

    menuOpen.addEventListener('click', () => {
        overlay.classList.add('overlay--active');
    });

    menuClose.addEventListener('click', () => {
        overlay.classList.remove('overlay--active');
    });


    d3.json('http://localhost:7070/countries').then(function (data) {
            var coutriesSelect = document.getElementById('cities');

            Object.keys(data).forEach(item => {
                    var op = document.createElement('option')
                    op.setAttribute('value', item);
                    op.append(document.createTextNode(data[item]));
                    coutriesSelect.appendChild(op);
                },
            );

        },
    )
    var begin = document.getElementById('start')
    var end = document.getElementById('end')
    document.getElementById('end').valueAsDate = new Date();
    begin.onchange = function () {
        console.log(begin.value)
        begin = document.getElementById('start')
        filterData(new Date(begin.value), new Date(end.value), document.querySelector(".selected").getAttribute('value'))
    }


    end.onchange = function () {
        end = document.getElementById('end')
        filterData(new Date(begin.value), new Date(end.value), document.querySelector(".selected").getAttribute('value'))

    }
    d3.json('http://localhost:7070/criteria').then(function (data) {


        var criteria = document.getElementsByClassName('options-container');
        data.forEach((item, index) => {
                var btn = document.createElement('div')
                btn.className = 'option'
                var input = document.createElement('input')
                input.setAttribute('type', 'radio')
                input.setAttribute('name', 'category')
                input.id = item
                input.className = "radio"
                var label = document.createElement('label')
                label.setAttribute('for', item)
                label.innerHTML = item.replaceAll('_', ' ')
                criteria[0].appendChild(btn)
                btn.appendChild(input)
                btn.appendChild(label)


                const selected = document.querySelector(".selected");

                const optionsContainer = document.querySelector(".options-container");

                const optionsList = document.querySelectorAll(".option");


                selected.addEventListener("click", () => {
                    optionsContainer.classList.toggle("active");
                });

                optionsList.forEach(o => {
                    o.addEventListener("click", () => {
                        var val = (o.querySelector("label").innerHTML).replaceAll(' ', '_')
                        selected.innerHTML = o.querySelector("label").innerHTML;
                        selected.setAttribute('value', val)
                        if (document.getElementById('cities').value !== '')

                            filterData(new Date(begin.value), new Date(end.value), val)
                        optionsContainer.classList.remove("active");

                    });
                });


                function setThisButtonActive(button) {
                    button.classList.replace('button-rect', 'button-rect-active');

                }

                /* select all active buttons, and remove the active class from them */
                function resetActiveButton() {
                    document.querySelectorAll('.button-rect-active').forEach((button) => {
                        button.classList.replace('button-rect-active', 'button-rect');
                    });
                }


                document.getElementById('cities').onchange = function (event) {
                    begin = document.getElementById('start')
                    end = document.getElementById('end')
                    selectData(event.target.value)
                    selected.innerHTML = "Total Cases"
                    selected.setAttribute('value', "total_cases")

                };


            },
        )


    })


</script>

</body>
</html>
